name: Scrape League Tables

on:
  schedule:
    - cron: '0 3 * * *'  #   -03:00
  workflow_dispatch:  # 驻砖专 专抓 转

jobs:
  group-1:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "637,639,741,654,651"
      - uses: actions/upload-artifact@v4
        with:
          name: group-1
          path: group_result.json

  group-2:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "641,808,860,823,809"
      - uses: actions/upload-artifact@v4
        with:
          name: group-2
          path: group_result.json

  group-3:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "859,705,815,749,717"
      - uses: actions/upload-artifact@v4
        with:
          name: group-3
          path: group_result.json

  group-4:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "900,810,901,903,902"
      - uses: actions/upload-artifact@v4
        with:
          name: group-4
          path: group_result.json

  group-5:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "101,103,102,105,104"
      - uses: actions/upload-artifact@v4
        with:
          name: group-5
          path: group_result.json

  group-6:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "920,787,666,110,115"
      - uses: actions/upload-artifact@v4
        with:
          name: group-6
          path: group_result.json

  group-7:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "726,121,120,646,755"
      - uses: actions/upload-artifact@v4
        with:
          name: group-7
          path: group_result.json

  group-8:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "123,122,665,664,773"
      - uses: actions/upload-artifact@v4
        with:
          name: group-8
          path: group_result.json

  group-9:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "719,720,135,139,706"
      - uses: actions/upload-artifact@v4
        with:
          name: group-9
          path: group_result.json

  group-10:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "131,137,130,658,134"
      - uses: actions/upload-artifact@v4
        with:
          name: group-10
          path: group_result.json

  group-11:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "824,845,826,736,663"
      - uses: actions/upload-artifact@v4
        with:
          name: group-11
          path: group_result.json

  group-12:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "758,759,146,816,707"
      - uses: actions/upload-artifact@v4
        with:
          name: group-12
          path: group_result.json

  group-13:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "144,871,155,734,870"
      - uses: actions/upload-artifact@v4
        with:
          name: group-13
          path: group_result.json

  group-14:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "648,865,764,875,876"
      - uses: actions/upload-artifact@v4
        with:
          name: group-14
          path: group_result.json

  group-15:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "662,862,152,156,788"
      - uses: actions/upload-artifact@v4
        with:
          name: group-15
          path: group_result.json

  group-16:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "150,712,872,863,158"
      - uses: actions/upload-artifact@v4
        with:
          name: group-16
          path: group_result.json

  group-17:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "154,861,880,739,748"
      - uses: actions/upload-artifact@v4
        with:
          name: group-17
          path: group_result.json

  group-18:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "689,852,868,804,881"
      - uses: actions/upload-artifact@v4
        with:
          name: group-18
          path: group_result.json

  group-19:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "882,897,161,165,792"
      - uses: actions/upload-artifact@v4
        with:
          name: group-19
          path: group_result.json

  group-20:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "879,160,747,767,878"
      - uses: actions/upload-artifact@v4
        with:
          name: group-20
          path: group_result.json

  group-21:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "167,163,877,765,886"
      - uses: actions/upload-artifact@v4
        with:
          name: group-21
          path: group_result.json

  group-22:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "887,175,713,769,890"
      - uses: actions/upload-artifact@v4
        with:
          name: group-22
          path: group_result.json

  group-23:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "888,770,883,884,794"
      - uses: actions/upload-artifact@v4
        with:
          name: group-23
          path: group_result.json

  group-24:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "738,173,793,744,170"
      - uses: actions/upload-artifact@v4
        with:
          name: group-24
          path: group_result.json

  group-25:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "172,885,891,174,892"
      - uses: actions/upload-artifact@v4
        with:
          name: group-25
          path: group_result.json

  group-26:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "661,780,750,649,908"
      - uses: actions/upload-artifact@v4
        with:
          name: group-26
          path: group_result.json

  group-27:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "182,631,737,838,771"
      - uses: actions/upload-artifact@v4
        with:
          name: group-27
          path: group_result.json

  group-28:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "819,180,710,183,801"
      - uses: actions/upload-artifact@v4
        with:
          name: group-28
          path: group_result.json

  group-29:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "799,840,800,904,660"
      - uses: actions/upload-artifact@v4
        with:
          name: group-29
          path: group_result.json

  group-30:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "839,181,806,752,640"
      - uses: actions/upload-artifact@v4
        with:
          name: group-30
          path: group_result.json

  group-31:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "732,912,913,843,798"
      - uses: actions/upload-artifact@v4
        with:
          name: group-31
          path: group_result.json

  group-32:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "659,851,657,844,921"
      - uses: actions/upload-artifact@v4
        with:
          name: group-32
          path: group_result.json

  group-33:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "922,842,186,918,722"
      - uses: actions/upload-artifact@v4
        with:
          name: group-33
          path: group_result.json

  group-34:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install requests beautifulsoup4
      - run: python group_scraper.py "795,652,916"
      - uses: actions/upload-artifact@v4
        with:
          name: group-34
          path: group_result.json

  merge-results:
    needs: [group-1, group-2, group-3, group-4, group-5, group-6, group-7, group-8, group-9, group-10, group-11, group-12, group-13, group-14, group-15, group-16, group-17, group-18, group-19, group-20, group-21, group-22, group-23, group-24, group-25, group-26, group-27, group-28, group-29, group-30, group-31, group-32, group-33, group-34]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v4
      - name: Merge all JSONs
        run: |
          echo "[" > leagues_tables.json
          first=true
          for file in group-*/group_result.json; do
            if [ "$first" = true ]; then
              first=false
            else
              echo "," >> leagues_tables.json
            fi
            cat "$file" | jq '.[]' >> leagues_tables.json
          done
          echo "]" >> leagues_tables.json
          
          # 爪 住住拽转
          echo " Total leagues:" $(cat leagues_tables.json | jq 'length')
      
      - name: Commit to repo
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add leagues_tables.json
          git commit -m "Update league tables $(date +%Y-%m-%d)"
          git push
